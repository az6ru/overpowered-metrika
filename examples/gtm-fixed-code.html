<!-- 
    –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ö–û–î –î–õ–Ø GOOGLE TAG MANAGER
    –ü–µ—Ä–µ–¥–∞–µ—Ç –í–°–ï –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∏—Å–∫–ª—é—á–∞—è null –∑–Ω–∞—á–µ–Ω–∏—è
    
    –ó–ê–ú–ï–ù–ò–¢–ï:
    - 45047126 –Ω–∞ –≤–∞—à ID —Å—á–µ—Ç—á–∏–∫–∞ –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∏
    - public_CtOgbP-edO5NnL6A3rbKtlX0Xzxvx-CVeyW –Ω–∞ –≤–∞—à API –∫–ª—é—á OverpoweredJS
-->

<!-- OverpoweredJS CDN -->
<script src="https://cdn.overpoweredjs.com/loader/opjs"></script>

<!-- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è OverpoweredJS + –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∞ -->
<script>
(function() {
    // –ù–ê–°–¢–†–û–ô–ö–ò - –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–®–ò –ó–ù–ê–ß–ï–ù–ò–Ø
    var METRIKA_ID = '45047126';  // –í–ê–® ID –°–ß–ï–¢–ß–ò–ö–ê –Ø–ù–î–ï–ö–° –ú–ï–¢–†–ò–ö–ò
    var API_KEY = 'public_CtOgbP-edO5NnL6A3rbKtlX0Xzxvx-CVeyW';  // –í–ê–® API –ö–õ–Æ–ß OVERPOWEREDJS
    var DEBUG = true;  // true –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏, false –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
    
    var sessionKey = 'overpowered_metrika_sent_' + METRIKA_ID;
    var clickHandled = false;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É
    function isAlreadySent() {
        try {
            return sessionStorage.getItem(sessionKey) === 'true';
        } catch (e) {
            return false;
        }
    }
    
    // –û—Ç–º–µ—Ç–∫–∞ –æ–± –æ—Ç–ø—Ä–∞–≤–∫–µ
    function markAsSent() {
        try {
            sessionStorage.setItem(sessionKey, 'true');
        } catch (e) {
            if (DEBUG) console.warn('[OverpoweredMetrika] SessionStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è (–∏—Å–∫–ª—é—á–∞–µ—Ç null/undefined)
    function safeValue(value, defaultValue) {
        if (value === null || value === undefined) {
            return defaultValue;
        }
        return value;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –Ω–µ null/undefined
    function addParam(obj, key, value) {
        if (value !== null && value !== undefined) {
            obj[key] = value;
        }
    }
    
    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
    function sendOverpoweredDataToMetrika() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ –ª–∏ —É–∂–µ
        if (isAlreadySent()) {
            if (DEBUG) console.log('[OverpoweredMetrika] –î–∞–Ω–Ω—ã–µ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ —ç—Ç–æ–º –≤–∏–∑–∏—Ç–µ');
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API
        if (typeof window.opjs === 'undefined') {
            console.error('[OverpoweredMetrika] OverpoweredJS –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }
        
        if (typeof window.ym === 'undefined') {
            console.error('[OverpoweredMetrika] –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            return;
        }
        
        if (DEBUG) console.log('[OverpoweredMetrika] –ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö...');
        
        // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ OverpoweredJS
        window.opjs({ API_KEY: API_KEY }).then(function(data) {
            if (DEBUG) console.log('[OverpoweredMetrika] –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ OverpoweredJS:', data);
            
            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è –ú–µ—Ç—Ä–∏–∫–∏, –¥–æ–±–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ –Ω–µ–ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            var metrikaData = {};
            
            // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            addParam(metrikaData, 'overpowered_bot_score', data.botScore);
            addParam(metrikaData, 'overpowered_cluster_uuid', data.clusterUUID);
            addParam(metrikaData, 'overpowered_last_seen', data.lastSeen);
            
            // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±—Ä–∞—É–∑–µ—Ä–∞
            if (data.browserTraits) {
                addParam(metrikaData, 'browser_type', data.browserTraits.type);
                addParam(metrikaData, 'browser_has_canvas_noise', data.browserTraits.hasCanvasNoise);
                addParam(metrikaData, 'browser_is_incognito', data.browserTraits.isIncognito);
                addParam(metrikaData, 'browser_is_webview', data.browserTraits.isWebView);
                addParam(metrikaData, 'browser_is_android_webview', data.browserTraits.isAndroidWebView);
                addParam(metrikaData, 'browser_fake_user_agent', data.browserTraits.isFakeUserAgent);
                addParam(metrikaData, 'browser_rooted_device', data.browserTraits.isRootedDevice);
                addParam(metrikaData, 'browser_anti_detect', data.browserTraits.isAntiDetect);
                
                // –ö–æ–¥—ã —Å—Ç—Ä–∞–Ω –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞
                if (data.browserTraits.possibleCountryCodes && data.browserTraits.possibleCountryCodes.length > 0) {
                    addParam(metrikaData, 'browser_country_codes', data.browserTraits.possibleCountryCodes.join(','));
                }
            }
            
            // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            if (data.debug) {
                addParam(metrikaData, 'overpowered_performance', data.debug.performance);
                // –•–µ—à –Ω–µ –ø–µ—Ä–µ–¥–∞–µ–º –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
            }
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            addParam(metrikaData, 'overpowered_risk_level', data.botScore > 7 ? 'high' : data.botScore > 4 ? 'medium' : 'low');
            addParam(metrikaData, 'overpowered_timestamp', new Date().toISOString());
            
            if (DEBUG) {
                console.log('[OverpoweredMetrika] –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –ú–µ—Ç—Ä–∏–∫—É:', metrikaData);
                console.log('[OverpoweredMetrika] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:', Object.keys(metrikaData).length);
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –ú–µ—Ç—Ä–∏–∫—É
            window.ym(METRIKA_ID, 'userParams', metrikaData);
            
            // –û—Ç–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ
            markAsSent();
            
            if (DEBUG) {
                console.log('[OverpoweredMetrika] ‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫—É');
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ü–µ–ª—å –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            if (data.botScore > 5) {
                var goalParams = {
                    bot_score: data.botScore,
                    risk_level: data.botScore > 7 ? 'high' : 'medium'
                };
                
                if (data.browserTraits && data.browserTraits.isAntiDetect) {
                    goalParams.anti_detect = true;
                }
                
                window.ym(METRIKA_ID, 'reachGoal', 'suspicious_activity', goalParams);
                
                if (DEBUG) console.log('[OverpoweredMetrika] üö® –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ü–µ–ª—å "suspicious_activity"', goalParams);
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ü–µ–ª—å –æ–± —É—Å–ø–µ—à–Ω–æ–º –∞–Ω–∞–ª–∏–∑–µ
            window.ym(METRIKA_ID, 'reachGoal', 'overpowered_analysis_completed', {
                bot_score: data.botScore,
                browser_type: data.browserTraits ? data.browserTraits.type : 'unknown',
                params_count: Object.keys(metrikaData).length
            });
            
        }).catch(function(error) {
            console.error('[OverpoweredMetrika] ‚ùå –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:', error);
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–∫–∞
    function handleFirstClick() {
        if (clickHandled) return;
        clickHandled = true;
        
        if (DEBUG) console.log('[OverpoweredMetrika] üëÜ –ü–µ—Ä–≤—ã–π –∫–ª–∏–∫ - –∑–∞–ø—É—Å–∫–∞–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é');
        sendOverpoweredDataToMetrika();
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è
    function addClickListener() {
        document.addEventListener('click', handleFirstClick);
        if (DEBUG) console.log('[OverpoweredMetrika] üìù –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω');
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            if (DEBUG) console.log('[OverpoweredMetrika] üöÄ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫');
            addClickListener();
        });
    } else {
        if (DEBUG) console.log('[OverpoweredMetrika] üöÄ DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫');
        addClickListener();
    }
    
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
    if (DEBUG) {
        window.OverpoweredMetrikaForceRun = function() {
            console.log('[OverpoweredMetrika] üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫...');
            clickHandled = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥
            sendOverpoweredDataToMetrika();
        };
        
        window.OverpoweredMetrikaClearSession = function() {
            try {
                sessionStorage.removeItem(sessionKey);
                console.log('[OverpoweredMetrika] üóëÔ∏è –°–µ—Å—Å–∏—è –æ—á–∏—â–µ–Ω–∞');
            } catch (e) {
                console.warn('[OverpoweredMetrika] –ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å —Å–µ—Å—Å–∏—é');
            }
        };
        
        console.log('[OverpoweredMetrika] üõ†Ô∏è –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã:');
        console.log('- OverpoweredMetrikaForceRun() - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫');
        console.log('- OverpoweredMetrikaClearSession() - –æ—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–∏');
    }
    
})();
</script>
