<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å—Ç–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OverpoweredJS + –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∞</title>
</head>
<body>
    <h1>–ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è OverpoweredJS —Å –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–æ–π</h1>
    <p>–î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ –≤–∏–∑–∏—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.</p>
    
    <button id="test-button">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</button>
    <div id="result"></div>

    <!-- –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∞ -->
    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){
            m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {
                if (document.scripts[j].src === r) { return; }
            }
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
        })(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

        // –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® ID –°–ß–ï–¢–ß–ò–ö–ê
        ym('YOUR_COUNTER_ID', 'init', {
            clickmap: true,
            trackLinks: true,
            accurateTrackBounce: true
        });
    </script>

    <!-- OverpoweredJS -->
    <script src="https://cdn.overpoweredjs.com/loader/opjs"></script>

    <!-- –ù–∞—à–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è -->
    <script src="../src/core/MetrikaIntegration.js"></script>

    <!-- –ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è -->
    <script>
        // –ù–ê–°–¢–†–û–ô–ö–ò - –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–®–ò –ó–ù–ê–ß–ï–ù–ò–Ø
        const METRIKA_COUNTER_ID = 'YOUR_COUNTER_ID';  // –í–∞—à ID —Å—á–µ—Ç—á–∏–∫–∞ –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∏
        const OVERPOWERED_API_KEY = 'public_CtOgbP-edO5NnL6A3rbKtlX0Xzxvx-CVeyW';  // –í–∞—à API –∫–ª—é—á OverpoweredJS

        let integration;
        let isProcessing = false;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
                integration = new MetrikaIntegration(METRIKA_COUNTER_ID, OVERPOWERED_API_KEY, {
                    autoSend: false,     // –û—Ç–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–æ—Ç–ø—Ä–∞–≤–∫—É
                    debug: true,         // –í–∫–ª—é—á–∞–µ–º –æ—Ç–ª–∞–¥–∫—É
                    oncePerVisit: true   // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ –≤–∏–∑–∏—Ç
                });

                console.log('‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ (–∫–∞–∫ –≤ –≤–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ)
        document.addEventListener('click', async function(event) {
            if (isProcessing || !integration) return;

            isProcessing = true;
            const resultDiv = document.getElementById('result');
            
            try {
                resultDiv.innerHTML = '<p>üîÑ –°–±–æ—Ä –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>';
                console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö OverpoweredJS...');

                // –°–æ–±–∏—Ä–∞–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                const result = await integration.collectAndSend();

                if (result.skipped) {
                    resultDiv.innerHTML = `
                        <div style="background: #fff3cd; padding: 15px; border-radius: 5px; margin: 10px 0;">
                            <h3>‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã</h3>
                            <p>–í —ç—Ç–æ–º –≤–∏–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –±—ã–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫—É.</p>
                            <p><small>–ü—Ä–∏—á–∏–Ω–∞: ${result.reason}</small></p>
                        </div>
                    `;
                    console.log('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ —ç—Ç–æ–º –≤–∏–∑–∏—Ç–µ');

                } else if (result.success) {
                    resultDiv.innerHTML = `
                        <div style="background: #d4edda; padding: 15px; border-radius: 5px; margin: 10px 0;">
                            <h3>‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!</h3>
                            <p>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±—Ä–∞—É–∑–µ—Ä–∞ –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫—É.</p>
                            <details>
                                <summary>–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</summary>
                                <pre style="background: #f8f9fa; padding: 10px; margin: 10px 0; font-size: 12px; overflow: auto;">${JSON.stringify(result.data, null, 2)}</pre>
                            </details>
                        </div>
                    `;
                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫—É:', result.data);

                } else {
                    resultDiv.innerHTML = `
                        <div style="background: #f8d7da; padding: 15px; border-radius: 5px; margin: 10px 0;">
                            <h3>‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏</h3>
                            <p>${result.error}</p>
                        </div>
                    `;
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', result.error);
                }

            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="background: #f8d7da; padding: 15px; border-radius: 5px; margin: 10px 0;">
                        <h3>‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞</h3>
                        <p>${error.message}</p>
                    </div>
                `;
                console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);

            } finally {
                isProcessing = false;
            }
        });

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ü–µ–ª–∏ –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        async function checkAndSendSuspiciousGoal() {
            if (!integration || !integration.overpoweredData) return;

            const data = integration.overpoweredData;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
            if (data.botScore && data.botScore > 5) {
                integration.sendGoal('suspicious_activity', {
                    bot_score: data.botScore,
                    browser_type: data.browserTraits?.type
                });
                console.log('üö® –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ü–µ–ª—å "suspicious_activity"');
            }
        }

        // –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        setTimeout(checkAndSuspiciousGoal, 2000);
    </script>

    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 15px 30px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px 0;
        }

        button:hover {
            background-color: #45a049;
        }

        #result {
            margin: 20px 0;
        }

        details {
            margin: 10px 0;
        }

        summary {
            cursor: pointer;
            font-weight: bold;
        }

        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</body>
</html>
